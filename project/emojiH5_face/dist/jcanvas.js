/**
 * @license jCanvas v15.08.17
 * Copyright 2015 Caleb Evans
 * Released under the MIT license
 */

(function(a,b,c){typeof module=="object"&&typeof module.exports=="object"?module.exports=b.document&&typeof a!="undefined"?c(b,!0):function(a,b){return c(a,b)}:typeof define=="function"&&define.amd!=undefined?define(["jquery"],c):c(a,b)})(typeof window!="undefined"?window.$:{},typeof window!="undefined"?window:this,function(a,b){function c(a){var b=this,c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function d(){vb(this,d.baseDefaults)}function e(a){return xb(a)==="string"}function f(a){return!isNaN(ob(a))&&!isNaN(pb(a))}function g(a){return a&&a.getContext?a.getContext("2d"):sb}function h(a){var b,c,d;for(b in a)a.hasOwnProperty(b)&&(d=a[b],c=xb(d),c==="string"&&f(d)&&b!=="text"&&(a[b]=pb(d)));a.text!==undefined&&(a.text=String(a.text))}function i(a){return a=vb({},a),a.masks=a.masks.slice(0),a}function j(a,b){var c;a.save(),c=i(b.transforms),b.savedTransforms.push(c)}function k(a,b){b.savedTransforms.length===0?b.transforms=i(Kb):(a.restore(),b.transforms=b.savedTransforms.pop())}function l(a,b,c,d){c[d]&&(yb(c[d])?b[d]=c[d].call(a,c):b[d]=c[d])}function m(a,b,c){l(a,b,c,"fillStyle"),l(a,b,c,"strokeStyle"),b.lineWidth=c.strokeWidth,c.rounded?b.lineCap=b.lineJoin="round":(b.lineCap=c.strokeCap,b.lineJoin=c.strokeJoin,b.miterLimit=c.miterLimit),c.strokeDash||(c.strokeDash=[]),b.setLineDash&&b.setLineDash(c.strokeDash),b.webkitLineDash=b.mozDash=c.strokeDash,b.lineDashOffset=b.webkitLineDashOffset=b.mozDashOffset=c.strokeDashOffset,b.shadowOffsetX=c.shadowX,b.shadowOffsetY=c.shadowY,b.shadowBlur=c.shadowBlur,b.shadowColor=c.shadowColor,b.globalAlpha=c.opacity,b.globalCompositeOperation=c.compositing,c.imageSmoothing&&(b.imageSmoothingEnabled=b.mozImageSmoothingEnabled=c.imageSmoothingEnabled)}function n(a,b,c){c.mask&&(c.autosave&&j(a,b),a.clip(),b.transforms.masks.push(c._args))}function o(a,b){b._transformed&&a.restore()}function p(a,b,c){var d;c.closed&&b.closePath(),c.shadowStroke&&c.strokeWidth!==0?(b.stroke(),b.fill(),b.shadowColor="transparent",b.shadowBlur=0,b.stroke()):(b.fill(),c.fillStyle!=="transparent"&&(b.shadowColor="transparent"),c.strokeWidth!==0&&b.stroke()),c.closed||b.closePath(),o(b,c),c.mask&&(d=r(a),n(b,d,c))}function q(a,b,c,d,e){c._toRad=c.inDegrees?Ab/180:1,c._transformed=qb,b.save(),!c.fromCenter&&!c._centered&&d!==tb&&(e===tb&&(e=d),c.x+=d/2,c.y+=e/2,c._centered=qb),c.rotate&&S(b,c,sb),(c.scale!==1||c.scaleX!==1||c.scaleY!==1)&&T(b,c,sb),(c.translate||c.translateX||c.translateY)&&U(b,c,sb)}function r(b){var c=Jb.dataCache,d;return c._canvas===b&&c._data?d=c._data:(d=a.data(b,"jCanvas"),d||(d={canvas:b,layers:[],layer:{names:{},groups:{}},eventHooks:{},intersecting:[],lastIntersected:sb,cursor:a(b).css("cursor"),drag:{layer:sb,dragging:rb},event:{type:sb,x:sb,y:sb},events:{},transforms:i(Kb),savedTransforms:[],animating:rb,animated:sb,pixelRatio:1,scaled:rb},a.data(b,"jCanvas",d)),c._canvas=b,c._data=d),d}function s(a,b,c){var d;for(d in Nb.events)Nb.events.hasOwnProperty(d)&&(c[d]||c.cursors&&c.cursors[d])&&t(a,b,c,d);b.events.mouseout||(a.bind("mouseout.jCanvas",function(){var c=b.drag.layer,d;c&&(b.drag={},E(a,b,c,"dragcancel"));for(d=0;d<b.layers.length;d+=1)c=b.layers[d],c._hovered&&a.triggerLayerEvent(b.layers[d],"mouseout");a.drawLayers()}),b.events.mouseout=qb)}function t(a,b,c,d){Nb.events[d](a,b),c._event=qb}function u(a,b,c){var d,e,f;if(c.draggable||c.cursors){d=["mousedown","mousemove","mouseup"];for(f=0;f<d.length;f+=1)e=d[f],t(a,b,c,e);c._event=qb}}function v(a,b,c,d){var f=b.layer.names;d?d.name!==tb&&e(c.name)&&c.name!==d.name&&delete f[c.name]:d=c,e(d.name)&&(f[d.name]=c)}function w(a,b,c,d){var e=b.layer.groups,f,g,h,i,j;if(!d)d=c;else if(d.groups!==tb&&c.groups!==sb)for(h=0;h<c.groups.length;h+=1){g=c.groups[h],f=e[g];if(f){for(j=0;j<f.length;j+=1)if(f[j]===c){i=j,f.splice(j,1);break}f.length===0&&delete e[g]}}if(d.groups!==tb&&d.groups!==sb)for(h=0;h<d.groups.length;h+=1)g=d.groups[h],f=e[g],f||(f=e[g]=[],f.name=g),i===tb&&(i=f.length),f.splice(i,0,c)}function x(a){var b,c,d,e;b=sb;for(c=a.intersecting.length-1;c>=0;c-=1){b=a.intersecting[c];if(b._masks){for(e=b._masks.length-1;e>=0;e-=1){d=b._masks[e];if(!d.intersects){b.intersects=rb;break}}if(b.intersects&&!b.intangible)break}}return b&&b.intangible&&(b=sb),b}function y(a,b,c,d){c&&c.visible&&c._method&&(d?c._next=d:c._next=sb,c._method.call(a,c))}function z(a,b,c){var d,e,f,g,h,i,j,k,l,m;g=b.drag,e=g.layer,h=e&&e.dragGroups||[],d=b.layers;if(c==="mousemove"||c==="touchmove"){g.dragging||(g.dragging=qb,e.dragging=qb,e.bringToFront&&(d.splice(e.index,1),e.index=d.push(e)),e._startX=e.x,e._startY=e.y,e._endX=e._eventX,e._endY=e._eventY,E(a,b,e,"dragstart"));if(g.dragging){l=e._eventX-(e._endX-e._startX),m=e._eventY-(e._endY-e._startY),e.dx=l-e.x,e.dy=m-e.y,e.restrictDragToAxis!=="y"&&(e.x=l),e.restrictDragToAxis!=="x"&&(e.y=m),E(a,b,e,"drag");for(k=0;k<h.length;k+=1){j=h[k],i=b.layer.groups[j];if(e.groups&&i)for(f=0;f<i.length;f+=1)i[f]!==e&&(e.restrictDragToAxis!=="y"&&i[f].restrictDragToAxis!=="y"&&(i[f].x+=e.dx),e.restrictDragToAxis!=="x"&&i[f].restrictDragToAxis!=="x"&&(i[f].y+=e.dy))}}}else if(c==="mouseup"||c==="touchend")g.dragging&&(e.dragging=rb,g.dragging=rb,E(a,b,e,"dragstop")),b.drag={}}function A(b,c,d){var e;c.cursors&&(e=c.cursors[d]),a.inArray(e,Lb.cursors)!==-1&&(e=Lb.prefix+e),e&&b.css({cursor:e})}function B(a,b){a.css({cursor:b.cursor})}function C(a,b,c,d,e){d[c]&&b._running&&!b._running[c]&&(b._running[c]=qb,d[c].call(a[0],b,e),b._running[c]=rb)}function D(b,c){return!b.disableEvents&&(!b.intangible||a.inArray(c,Mb)===-1)}function E(a,b,c,d,e){D(c,d)&&(d!=="mouseout"&&A(a,c,d),C(a,c,d,c,e),C(a,c,d,b.eventHooks,e),C(a,c,d,Nb.eventHooks,e))}function F(b,d,f,g){var i,j,k,l=d._layer?f:d;d._args=f;if(d.draggable||d.dragGroups)d.layer=qb,d.draggable=qb;d._method||(g?d._method=g:d.method?d._method=a.fn[d.method]:d.type?d._method=a.fn[Ib.drawings[d.type]]:d._method=function(){});if(d.layer&&!d._layer){i=a(b),j=r(b),k=j.layers;if(l.name===sb||e(l.name)&&j.layer.names[l.name]===tb)h(d),l=new c(d),l.canvas=b,l.layer=qb,l._layer=qb,l._running={},l.data!==sb?l.data=vb({},l.data):l.data={},l.groups!==sb?l.groups=l.groups.slice(0):l.groups=[],v(i,j,l),w(i,j,l),s(i,j,l),u(i,j,l),d._event=l._event,l._method===a.fn.drawText&&i.measureText(l),l.index===sb&&(l.index=k.length),k.splice(l.index,0,l),d._args=l,E(i,j,l,"add")}else d.layer||h(d);return l}function G(a){var b,c;for(c=0;c<Lb.props.length;c+=1)b=Lb.props[c],a[b]=a["_"+b]}function H(a,b){var c,d;for(d=0;d<Lb.props.length;d+=1)c=Lb.props[d],a[c]!==tb&&(a["_"+c]=a[c],Lb.propsObj[c]=qb,b&&delete a[c])}function I(a,b,c){var d,e,f,g;for(d in c)if(c.hasOwnProperty(d)){e=c[d],yb(e)&&(c[d]=e.call(a,b,d));if(xb(e)==="object"&&zb(e)){for(f in e)e.hasOwnProperty(f)&&(g=e[f],b[d]!==tb&&(b[d+"."+f]=b[d][f],c[d+"."+f]=g));delete c[d]}}return c}function J(a){var b;for(b in a)a.hasOwnProperty(b)&&b.indexOf(".")!==-1&&delete a[b]}function K(b){var c,d,e=[],f=1;return b.match(/^([a-z]+|#[0-9a-f]+)$/gi)&&(b==="transparent"&&(b="rgba(0, 0, 0, 0)"),d=jb.head,c=d.style.color,d.style.color=b,b=a.css(d,"color"),d.style.color=c),b.match(/^rgb/gi)&&(e=b.match(/(\d+(\.\d+)?)/gi),b.match(/%/gi)&&(f=2.55),e[0]*=f,e[1]*=f,e[2]*=f,e[3]!==tb?e[3]=pb(e[3]):e[3]=1),e}function L(a){var b=3,c;xb(a.start)!=="array"&&(a.start=K(a.start),a.end=K(a.end)),a.now=[];if(a.start[3]!==1||a.end[3]!==1)b=4;for(c=0;c<b;c+=1)a.now[c]=a.start[c]+(a.end[c]-a.start[c])*a.pos,c<3&&(a.now[c]=Bb(a.now[c]));a.start[3]!==1||a.end[3]!==1?a.now="rgba( "+a.now.join(",")+" )":(a.now.slice(0,3),a.now="rgb( "+a.now.join(",")+" )"),a.elem.nodeName?a.elem.style[a.prop]=a.now:a.elem[a.prop]=a.now}function M(b){var c;for(c=0;c<b.length;c+=1)a.fx.step[b[c]]=L}function N(a){return Ib.touchEvents[a]&&(a=Ib.touchEvents[a]),a}function O(a){return Ib.mouseEvents[a]&&(a=Ib.mouseEvents[a]),a}function P(a){Nb.events[a]=function(b,c){function d(a){g.x=a.offsetX,g.y=a.offsetY,g.type=e,g.event=a,b.drawLayers({resetFire:qb}),a.preventDefault()}var e,f,g;g=c.event,e=a==="mouseover"||a==="mouseout"?"mousemove":a,f=N(e),c.events[e]||(f!==e?b.bind(e+".jCanvas "+f+".jCanvas",d):b.bind(e+".jCanvas",d),c.events[e]=qb)}}function Q(a){var b;for(b=0;b<a.length;b+=1)P(a[b])}function R(a,b,c){var d,e,f,g,h,i,j,k;d=c._args,d&&(e=r(a),f=e.event,f.x!==sb&&f.y!==sb&&(i=f.x*e.pixelRatio,j=f.y*e.pixelRatio,g=b.isPointInPath(i,j)||b.isPointInStroke&&b.isPointInStroke(i,j)),h=e.transforms,d.eventX=f.x,d.eventY=f.y,d.event=f.event,k=e.transforms.rotate,i=d.eventX,j=d.eventY,k!==0?(d._eventX=i*Eb(-k)-j*Db(-k),d._eventY=j*Eb(-k)+i*Db(-k)):(d._eventX=i,d._eventY=j),d._eventX/=h.scaleX,d._eventY/=h.scaleY,g&&e.intersecting.push(d),d.intersects=!!g)}function S(a,b,c){b._toRad=b.inDegrees?Ab/180:1,a.translate(b.x,b.y),a.rotate(b.rotate*b._toRad),a.translate(-b.x,-b.y),c&&(c.rotate+=b.rotate*b._toRad)}function T(a,b,c){b.scale!==1&&(b.scaleX=b.scaleY=b.scale),a.translate(b.x,b.y),a.scale(b.scaleX,b.scaleY),a.translate(-b.x,-b.y),c&&(c.scaleX*=b.scaleX,c.scaleY*=b.scaleY)}function U(a,b,c){b.translate&&(b.translateX=b.translateY=b.translate),a.translate(b.translateX,b.translateY),c&&(c.translateX+=b.translateX,c.translateY+=b.translateY)}function V(a){while(a<0)a+=2*Ab;return a}function W(a,b){return a.x+a.radius*Eb(b)}function X(a,b){return a.y+a.radius*Db(b)}function Y(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o;c===d?(m=0,n=0):(m=c.x,n=c.y),!d.inDegrees&&d.end===360&&(d.end=Ab*2),d.start*=c._toRad,d.end*=c._toRad,d.start-=Ab/2,d.end-=Ab/2,o=Ab/180,d.ccw&&(o*=-1),e=W(d,d.start+o),f=X(d,d.start+o),g=W(d,d.start),h=X(d,d.start),$(a,b,c,d,e,f,g,h),b.arc(d.x+m,d.y+n,d.radius,d.start,d.end,d.ccw),i=W(d,d.end+o),j=X(d,d.end+o),k=W(d,d.end),l=X(d,d.end),_(a,b,c,d,k,l,i,j)}function Z(a,b,c,d,e,f,g,h){var i,j,k,l,m,n,o;d.arrowRadius&&!c.closed&&(o=Fb(h-f,g-e),o-=Ab,m=c.strokeWidth*Eb(o),n=c.strokeWidth*Db(o),i=g+d.arrowRadius*Eb(o+d.arrowAngle/2),j=h+d.arrowRadius*Db(o+d.arrowAngle/2),k=g+d.arrowRadius*Eb(o-d.arrowAngle/2),l=h+d.arrowRadius*Db(o-d.arrowAngle/2),b.moveTo(i-m,j-n),b.lineTo(g-m,h-n),b.lineTo(k-m,l-n),b.moveTo(g-m,h-n),b.lineTo(g+m,h+n),b.moveTo(g,h))}function $(a,b,c,d,e,f,g,h){d._arrowAngleConverted||(d.arrowAngle*=c._toRad,d._arrowAngleConverted=qb),d.startArrow&&Z(a,b,c,d,e,f,g,h)}function _(a,b,c,d,e,f,g,h){d._arrowAngleConverted||(d.arrowAngle*=c._toRad,d._arrowAngleConverted=qb),d.endArrow&&Z(a,b,c,d,e,f,g,h)}function ab(a,b,c,d){var e,f,g;e=2,$(a,b,c,d,d.x2+c.x,d.y2+c.y,d.x1+c.x,d.y1+c.y),d.x1!==tb&&d.y1!==tb&&b.moveTo(d.x1+c.x,d.y1+c.y);while(qb){f=d["x"+e],g=d["y"+e];if(f===tb||g===tb)break;b.lineTo(f+c.x,g+c.y),e+=1}e-=1,_(a,b,c,d,d["x"+(e-1)]+c.x,d["y"+(e-1)]+c.y,d["x"+e]+c.x,d["y"+e]+c.y)}function bb(a,b,c,d){var e,f,g,h,i;e=2,$(a,b,c,d,d.cx1+c.x,d.cy1+c.y,d.x1+c.x,d.y1+c.y),d.x1!==tb&&d.y1!==tb&&b.moveTo(d.x1+c.x,d.y1+c.y);while(qb){f=d["x"+e],g=d["y"+e],h=d["cx"+(e-1)],i=d["cy"+(e-1)];if(f===tb||g===tb||h===tb||i===tb)break;b.quadraticCurveTo(h+c.x,i+c.y,f+c.x,g+c.y),e+=1}e-=1,_(a,b,c,d,d["cx"+(e-1)]+c.x,d["cy"+(e-1)]+c.y,d["x"+e]+c.x,d["y"+e]+c.y)}function cb(a,b,c,d){var e,f,g,h,i,j,k,l;e=2,f=1,$(a,b,c,d,d.cx1+c.x,d.cy1+c.y,d.x1+c.x,d.y1+c.y),d.x1!==tb&&d.y1!==tb&&b.moveTo(d.x1+c.x,d.y1+c.y);while(qb){g=d["x"+e],h=d["y"+e],i=d["cx"+f],j=d["cy"+f],k=d["cx"+(f+1)],l=d["cy"+(f+1)];if(g===tb||h===tb||i===tb||j===tb||k===tb||l===tb)break;b.bezierCurveTo(i+c.x,j+c.y,k+c.x,l+c.y,g+c.x,h+c.y),e+=1,f+=2}e-=1,f-=2,_(a,b,c,d,d["cx"+(f+1)]+c.x,d["cy"+(f+1)]+c.y,d["x"+e]+c.x,d["y"+e]+c.y)}function db(a,b,c){return b*=a._toRad,b-=Ab/2,c*Eb(b)}function eb(a,b,c){return b*=a._toRad,b-=Ab/2,c*Db(b)}function fb(a,b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p,q;c===d?(h=0,i=0):(h=c.x,i=c.y),e=1,j=l=n=p=d.x+h,k=m=o=q=d.y+i,$(a,b,c,d,j+db(c,d.a1,d.l1),k+eb(c,d.a1,d.l1),j,k),d.x!==tb&&d.y!==tb&&b.moveTo(j,k);while(qb){f=d["a"+e],g=d["l"+e];if(f===tb||g===tb)break;n=p,o=q,p+=db(c,f,g),q+=eb(c,f,g),e===1&&(l=p,m=q),b.lineTo(p,q),e+=1}_(a,b,c,d,n,o,p,q)}function gb(a,b,c){isNaN(ob(c.fontSize))||(c.fontSize+="px"),b.font=c.fontStyle+" "+c.fontSize+" "+c.fontFamily}function hb(b,c,d,e){var f,g,h,i=Jb.propCache;if(i.text===d.text&&i.fontStyle===d.fontStyle&&i.fontSize===d.fontSize&&i.fontFamily===d.fontFamily&&i.maxWidth===d.maxWidth&&i.lineHeight===d.lineHeight)d.width=i.width,d.height=i.height;else{d.width=c.measureText(e[0]).width;for(h=1;h<e.length;h+=1)g=c.measureText(e[h]).width,g>d.width&&(d.width=g);f=b.style.fontSize,b.style.fontSize=d.fontSize,d.height=pb(a.css(b,"fontSize"))*e.length*d.lineHeight,b.style.fontSize=f}}function ib(a,b){var c=b.text,d=b.maxWidth,e=c.split("\n"),f=[],g,h,i,j,k,l;for(i=0;i<e.length;i+=1){j=e[i],k=j.split(" "),g=[],h="";if(k.length===1||a.measureText(j).width<d)g=[j];else{for(l=0;l<k.length;l+=1)a.measureText(h+k[l]).width>d&&(h!==""&&g.push(h),h=""),h+=k[l],l!==k.length-1&&(h+=" ");g.push(h)}f=f.concat(g.join("\n").replace(/( (\n))|( $)/gi,"$2").split("\n"))}return f}b=b?b:this;var jb=b.document,kb=b.Image,lb=b.Array,mb=b.getComputedStyle,nb=b.Math,ob=b.Number,pb=b.parseFloat,qb=!0,rb=!1,sb=null,tb=undefined,ub,vb=a.extend,wb=a.inArray,xb=function(a){return Object.prototype.toString.call(a).slice(8,-1).toLowerCase()},yb=a.isFunction,zb=a.isPlainObject,Ab=nb.PI,Bb=nb.round,Cb=nb.abs,Db=nb.sin,Eb=nb.cos,Fb=nb.atan2,Gb=lb.prototype.slice,Hb=a.event.fix,Ib={},Jb={dataCache:{},propCache:{},imageCache:{}},Kb={rotate:0,scaleX:1,scaleY:1,translateX:0,translateY:0,masks:[]},Lb={},Mb=["mousedown","mousemove","mouseup","mouseover","mouseout","touchstart","touchmove","touchend"],Nb={events:{},eventHooks:{},future:{}};d.baseDefaults={align:"center",arrowAngle:90,arrowRadius:0,autosave:qb,baseline:"middle",bringToFront:rb,ccw:rb,closed:rb,compositing:"source-over",concavity:0,cornerRadius:0,count:1,cropFromCenter:qb,crossOrigin:sb,cursors:sb,disableEvents:rb,draggable:rb,dragGroups:sb,groups:sb,data:sb,dx:sb,dy:sb,end:360,eventX:sb,eventY:sb,fillStyle:"transparent",fontStyle:"normal",fontSize:"12pt",fontFamily:"sans-serif",fromCenter:qb,height:sb,imageSmoothing:qb,inDegrees:qb,intangible:rb,index:sb,letterSpacing:sb,lineHeight:1,layer:rb,mask:rb,maxWidth:sb,miterLimit:10,name:sb,opacity:1,r1:sb,r2:sb,radius:0,repeat:"repeat",respectAlign:rb,restrictDragToAxis:null,rotate:0,rounded:rb,scale:1,scaleX:1,scaleY:1,shadowBlur:0,shadowColor:"transparent",shadowStroke:rb,shadowX:0,shadowY:0,sHeight:sb,sides:0,source:"",spread:0,start:0,strokeCap:"butt",strokeDash:sb,strokeDashOffset:0,strokeJoin:"miter",strokeStyle:"transparent",strokeWidth:1,sWidth:sb,sx:sb,sy:sb,text:"",translate:0,translateX:0,translateY:0,type:sb,visible:qb,width:sb,x:0,y:0},ub=new d,c.prototype=ub,Nb.extend=function(b){return b.name&&(b.props&&vb(ub,b.props),a.fn[b.name]=function d(a){var e=this,f,h,i,j,k;for(h=0;h<e.length;h+=1)f=e[h],i=g(f),i&&(j=new c(a),k=F(f,j,a,d),m(f,i,j),b.fn.call(f,i,j));return e},b.type&&(Ib.drawings[b.type]=b.name)),a.fn[b.name]},a.fn.getEventHooks=function(){var a=this,b,c,d={};return a.length!==0&&(b=a[0],c=r(b),d=c.eventHooks),d},a.fn.setEventHooks=function(b){var c=this,d,e,f;for(e=0;e<c.length;e+=1)d=a(c[e]),f=r(c[e]),vb(f.eventHooks,b);return c},a.fn.getLayers=function(a){var b=this,c,d,e,f,g,h=[];if(b.length!==0){c=b[0],d=r(c),e=d.layers;if(yb(a))for(g=0;g<e.length;g+=1)f=e[g],a.call(c,f)&&h.push(f);else h=e}return h},a.fn.getLayer=function(a){var b=this,c,d,f,g,h,i;if(b.length!==0){c=b[0],d=r(c),f=d.layers,i=xb(a);if(a&&a.layer)g=a;else if(i==="number")a<0&&(a=f.length+a),g=f[a];else if(i==="regexp"){for(h=0;h<f.length;h+=1)if(e(f[h].name)&&f[h].name.match(a)){g=f[h];break}}else g=d.layer.names[a]}return g},a.fn.getLayerGroup=function(a){var b=this,c,d,e,f,g,h=xb(a);if(b.length!==0){c=b[0];if(h==="array")g=a;else if(h==="regexp"){d=r(c),e=d.layer.groups;for(f in e)if(f.match(a)){g=e[f];break}}else d=r(c),g=d.layer.groups[a]}return g},a.fn.getLayerIndex=function(a){var b=this,c=b.getLayers(),d=b.getLayer(a);return wb(d,c)},a.fn.setLayer=function(b,c){var d=this,e,g,i,j,k,l,m;for(g=0;g<d.length;g+=1){e=a(d[g]),i=r(d[g]),j=a(d[g]).getLayer(b);if(j){v(e,i,j,c),w(e,i,j,c),h(c);for(k in c)c.hasOwnProperty(k)&&(l=c[k],m=xb(l),m==="object"&&zb(l)?(j[k]=vb({},l),h(j[k])):m==="array"?j[k]=l.slice(0):m==="string"?l.indexOf("+=")===0?j[k]+=pb(l.substr(2)):l.indexOf("-=")===0?j[k]-=pb(l.substr(2)):!isNaN(l)&&f(l)?j[k]=pb(l):j[k]=l:j[k]=l);s(e,i,j),u(e,i,j),a.isEmptyObject(c)===rb&&E(e,i,j,"change",c)}}return d},a.fn.setLayers=function(b,c){var d=this,e,f,g,h;for(f=0;f<d.length;f+=1){e=a(d[f]),g=e.getLayers(c);for(h=0;h<g.length;h+=1)e.setLayer(g[h],b)}return d},a.fn.setLayerGroup=function(b,c){var d=this,e,f,g,h;for(f=0;f<d.length;f+=1){e=a(d[f]),g=e.getLayerGroup(b);if(g)for(h=0;h<g.length;h+=1)e.setLayer(g[h],c)}return d},a.fn.moveLayer=function(b,c){var d=this,e,f,g,h,i;for(f=0;f<d.length;f+=1)e=a(d[f]),g=r(d[f]),h=g.layers,i=e.getLayer(b),i&&(i.index=wb(i,h),h.splice(i.index,1),h.splice(c,0,i),c<0&&(c=h.length+c),i.index=c,E(e,g,i,"move"));return d},a.fn.removeLayer=function(b){var c=this,d,e,f,g,h;for(e=0;e<c.length;e+=1)d=a(c[e]),f=r(c[e]),g=d.getLayers(),h=d.getLayer(b),h&&(h.index=wb(h,g),g.splice(h.index,1),delete h._layer,v(d,f,h,{name:sb}),w(d,f,h,{groups:sb}),E(d,f,h,"remove"));return c},a.fn.removeLayers=function(b){var c=this,d,e,f,g,h,i;for(e=0;e<c.length;e+=1){d=a(c[e]),f=r(c[e]),g=d.getLayers(b);for(i=0;i<g.length;i+=1)h=g[i],d.removeLayer(h),i-=1;f.layer.names={},f.layer.groups={}}return c},a.fn.removeLayerGroup=function(b){var c=this,d,e,f,g,h,i;if(b!==tb)for(e=0;e<c.length;e+=1){d=a(c[e]),f=r(c[e]),g=d.getLayers(),h=d.getLayerGroup(b);if(h){h=h.slice(0);for(i=0;i<h.length;i+=1)d.removeLayer(h[i])}}return c},a.fn.addLayerToGroup=function(b,c){var d=this,e,f,g,h=[c];for(f=0;f<d.length;f+=1)e=a(d[f]),g=e.getLayer(b),g.groups&&(h=g.groups.slice(0),wb(c,g.groups)===-1&&h.push(c)),e.setLayer(g,{groups:h});return d},a.fn.removeLayerFromGroup=function(b,c){var d=this,e,f,g,h=[],i;for(f=0;f<d.length;f+=1)e=a(d[f]),g=e.getLayer(b),g.groups&&(i=wb(c,g.groups),i!==-1&&(h=g.groups.slice(0),h.splice(i,1),e.setLayer(g,{groups:h})));return d},Lb.cursors=["grab","grabbing","zoom-in","zoom-out"],Lb.prefix=function(){var a=mb(jb.documentElement,""),b=(Gb.call(a).join("").match(/-(moz|webkit|ms)-/)||a.OLink===""&&["","o"])[1];return"-"+b+"-"}(),a.fn.triggerLayerEvent=function(b,c){var d=this,e,f,g;for(f=0;f<d.length;f+=1)e=a(d[f]),g=r(d[f]),b=e.getLayer(b),b&&E(e,g,b,c);return d},a.fn.drawLayer=function(b){var c=this,d,e,f,h;for(d=0;d<c.length;d+=1)f=a(c[d]),e=g(c[d]),e&&(h=f.getLayer(b),y(f,e,h));return c},a.fn.drawLayers=function(b){var c=this,d,e,f,h=b||{},j,k,l,m,n,o,p,q,s,t;n=h.index,n||(n=0);for(e=0;e<c.length;e+=1){d=a(c[e]),f=g(c[e]);if(f){p=r(c[e]),h.clear!==rb&&d.clearCanvas(),j=p.layers;for(m=n;m<j.length;m+=1){k=j[m],k.index=m,h.resetFire&&(k._fired=rb),y(d,f,k,m+1),k._masks=p.transforms.masks.slice(0);if(k._method===a.fn.drawImage&&k.visible){t=!0;break}}if(t)break;o=m,k=x(p),q=p.event,s=q.type,p.drag.layer&&z(d,p,s),l=p.lastIntersected,l!==sb&&k!==l&&l._hovered&&!l._fired&&!p.drag.dragging&&(p.lastIntersected=sb,l._fired=qb,l._hovered=rb,E(d,p,l,"mouseout"),B(d,p)),k&&(k[s]||(s=O(s)),k._event&&k.intersects&&(p.lastIntersected=k,(k.mouseover||k.mouseout||k.cursors)&&!p.drag.dragging&&!k._hovered&&!k._fired&&(k._fired=qb,k._hovered=qb,E(d,p,k,"mouseover")),k._fired||(k._fired=qb,q.type=sb,E(d,p,k,s)),k.draggable&&!k.disableEvents&&(s==="mousedown"||s==="touchstart")&&(p.drag.layer=k))),k===sb&&!p.drag.dragging&&B(d,p),o===j.length&&(p.intersecting.length=0,p.transforms=i(Kb),p.savedTransforms.length=0)}}return c},a.fn.addLayer=function(a){var b=this,d,e,f;for(d=0;d<b.length;d+=1)e=g(b[d]),e&&(f=new c(a),f.layer=qb,F(b[d],f,a));return b},Lb.props=["width","height","opacity","lineHeight"],Lb.propsObj={},a.fn.animateLayer=function(){function b(a,b,c){return function(){G(c),J(c),(!b.animating||b.animated===c)&&a.drawLayers(),c._animating=rb,b.animating=rb,b.animated=sb,i[4]&&i[4].call(a[0],c),E(a,b,c,"animateend")}}function c(a,b,c){return function(d,e){var f,g,h,j=!1;e.prop[0]==="_"&&(j=!0,e.prop=e.prop.replace("_",""),c[e.prop]=c["_"+e.prop]),e.prop.indexOf(".")!==-1&&(f=e.prop.split("."),g=f[0],h=f[1],c[g]&&(c[g][h]=e.now)),c._pos!==e.pos&&(c._pos=e.pos,!c._animating&&!b.animating&&(c._animating=qb,b.animating=qb,b.animated=c),(!b.animating||b.animated===c)&&a.drawLayers()),i[5]&&i[5].call(a[0],d,e,c),E(a,b,c,"animate",e),j&&(e.prop="_"+e.prop)}}var d=this,e,f,h,i=Gb.call(arguments,0),j,k,l;xb(i[2])==="object"?(i.splice(2,0,i[2].duration||sb),i.splice(3,0,i[3].easing||sb),i.splice(4,0,i[4].complete||sb),i.splice(5,0,i[5].step||sb)):(i[2]===tb?(i.splice(2,0,sb),i.splice(3,0,sb),i.splice(4,0,sb)):yb(i[2])&&(i.splice(2,0,sb),i.splice(3,0,sb)),i[3]===tb?(i[3]=sb,i.splice(4,0,sb)):yb(i[3])&&i.splice(3,0,sb));for(f=0;f<d.length;f+=1)e=a(d[f]),h=g(d[f]),h&&(j=r(d[f]),k=e.getLayer(i[0]),k&&k._method!==a.fn.draw&&(l=vb({},i[1]),l=I(d[f],k,l),H(l,qb),H(k),k.style=Lb.propsObj,a(k).animate(l,{duration:i[2],easing:a.easing[i[3]]?i[3]:sb,complete:b(e,j,k),step:c(e,j,k)}),E(e,j,k,"animatestart")));return d},a.fn.animateLayerGroup=function(b){var c=this,d,e,f=Gb.call(arguments,0),g,h;for(e=0;e<c.length;e+=1){d=a(c[e]),g=d.getLayerGroup(b);if(g)for(h=0;h<g.length;h+=1)f[0]=g[h],d.animateLayer.apply(d,f)}return c},a.fn.delayLayer=function(b,c){var d=this,e,f,g,h;c=c||0;for(f=0;f<d.length;f+=1)e=a(d[f]),g=r(d[f]),h=e.getLayer(b),h&&(a(h).delay(c),E(e,g,h,"delay"));return d},a.fn.delayLayerGroup=function(b,c){var d=this,e,f,g,h,i;c=c||0;for(f=0;f<d.length;f+=1){e=a(d[f]),g=e.getLayerGroup(b);if(g)for(i=0;i<g.length;i+=1)h=g[i],e.delayLayer(h,c)}return d},a.fn.stopLayer=function(b,c){var d=this,e,f,g,h;for(f=0;f<d.length;f+=1)e=a(d[f]),g=r(d[f]),h=e.getLayer(b),h&&(a(h).stop(c),E(e,g,h,"stop"));return d},a.fn.stopLayerGroup=function(b,c){var d=this,e,f,g,h,i;for(f=0;f<d.length;f+=1){e=a(d[f]),g=e.getLayerGroup(b);if(g)for(i=0;i<g.length;i+=1)h=g[i],e.stopLayer(h,c)}return d},M(["color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","fillStyle","outlineColor","strokeStyle","shadowColor"]),Ib.touchEvents={mousedown:"touchstart",mouseup:"touchend",mousemove:"touchmove"},Ib.mouseEvents={touchstart:"mousedown",touchend:"mouseup",touchmove:"mousemove"},Q(["click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","touchstart","touchmove","touchend","contextmenu"]),a.event.fix=function(b){var c,d,e;return b=Hb.call(a.event,b),d=b.originalEvent,d&&(e=d.changedTouches,b.pageX!==tb&&b.offsetX===tb?(c=a(b.currentTarget).offset(),c&&(b.offsetX=b.pageX-c.left,b.offsetY=b.pageY-c.top)):e&&(c=a(b.currentTarget).offset(),c&&(b.offsetX=e[0].pageX-c.left,b.offsetY=e[0].pageY-c.top))),b},Ib.drawings={arc:"drawArc",bezier:"drawBezier",ellipse:"drawEllipse","function":"draw",image:"drawImage",line:"drawLine",path:"drawPath",polygon:"drawPolygon",slice:"drawSlice",quadratic:"drawQuadratic",rectangle:"drawRect",text:"drawText",vector:"drawVector",save:"saveCanvas",restore:"restoreCanvas",rotate:"rotateCanvas",scale:"scaleCanvas",translate:"translateCanvas"},a.fn.draw=function Ob(b){var d=this,e,f,h,i=new c(b),j;if(Ib.drawings[i.type]&&i.type!=="function")d[Ib.drawings[i.type]](b);else for(f=0;f<d.length;f+=1)e=a(d[f]),h=g(d[f]),h&&(i=new c(b),j=F(d[f],i,b,Ob),i.visible&&i.fn&&i.fn.call(d[f],h,i));return d},a.fn.clearCanvas=function Pb(a){var b=this,d,e,f=new c(a),h;for(d=0;d<b.length;d+=1)e=g(b[d]),e&&(f.width===sb||f.height===sb?(e.save(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,b[d].width,b[d].height),e.restore()):(h=F(b[d],f,a,Pb),q(b[d],e,f,f.width,f.height),e.clearRect(f.x-f.width/2,f.y-f.height/2,f.width,f.height),o(e,f)));return b},a.fn.saveCanvas=function Qb(a){var b=this,d,e,f,h,i,k;for(d=0;d<b.length;d+=1){e=g(b[d]);if(e){i=r(b[d]),f=new c(a),h=F(b[d],f,a,Qb);for(k=0;k<f.count;k+=1)j(e,i)}}return b},a.fn.restoreCanvas=function Rb(a){var b=this,d,e,f,h,i,j;for(d=0;d<b.length;d+=1){e=g(b[d]);if(e){i=r(b[d]),f=new c(a),h=F(b[d],f,a,Rb);for(j=0;j<f.count;j+=1)k(e,i)}}return b},a.fn.rotateCanvas=function Sb(a){var b=this,d,e,f,h,i;for(d=0;d<b.length;d+=1)e=g(b[d]),e&&(i=r(b[d]),f=new c(a),h=F(b[d],f,a,Sb),f.autosave&&j(e,i),S(e,f,i.transforms));return b},a.fn.scaleCanvas=function Tb(a){var b=this,d,e,f,h,i;for(d=0;d<b.length;d+=1)e=g(b[d]),e&&(i=r(b[d]),f=new c(a),h=F(b[d],f,a,Tb),f.autosave&&j(e,i),T(e,f,i.transforms));return b},a.fn.translateCanvas=function Ub(a){var b=this,d,e,f,h,i;for(d=0;d<b.length;d+=1)e=g(b[d]),e&&(i=r(b[d]),f=new c(a),h=F(b[d],f,a,Ub),f.autosave&&j(e,i),U(e,f,i.transforms));return b},a.fn.drawRect=function Vb(a){var b=this,d,e,f,h,i,j,k,l,n,o;for(d=0;d<b.length;d+=1)e=g(b[d]),e&&(f=new c(a),h=F(b[d],f,a,Vb),f.visible&&(q(b[d],e,f,f.width,f.height),m(b[d],e,f),e.beginPath(),f.width&&f.height&&(i=f.x-f.width/2,j=f.y-f.height/2,n=Cb(f.cornerRadius),n?(k=f.x+f.width/2,l=f.y+f.height/2,f.width<0&&(o=i,i=k,k=o),f.height<0&&(o=j,j=l,l=o),k-i-2*n<0&&(n=(k-i)/2),l-j-2*n<0&&(n=(l-j)/2),e.moveTo(i+n,j),e.lineTo(k-n,j),e.arc(k-n,j+n,n,3*Ab/2,Ab*2,rb),e.lineTo(k,l-n),e.arc(k-n,l-n,n,0,Ab/2,rb),e.lineTo(i+n,l),e.arc(i+n,l-n,n,Ab/2,Ab,rb),e.lineTo(i,j+n),e.arc(i+n,j+n,n,Ab,3*Ab/2,rb),f.closed=qb):e.rect(i,j,f.width,f.height)),R(b[d],e,f),p(b[d],e,f)));return b},a.fn.drawArc=function Wb(a){var b=this,d,e,f,h;for(d=0;d<b.length;d+=1)e=g(b[d]),e&&(f=new c(a),h=F(b[d],f,a,Wb),f.visible&&(q(b[d],e,f,f.radius*2),m(b[d],e,f),e.beginPath(),Y(b[d],e,f,f),R(b[d],e,f),p(b[d],e,f)));return b},a.fn.drawEllipse=function Xb(a){var b=this,d,e,f,h,i,j;for(d=0;d<b.length;d+=1)e=g(b[d]),e&&(f=new c(a),h=F(b[d],f,a,Xb),f.visible&&(q(b[d],e,f,f.width,f.height),m(b[d],e,f),i=f.width*(4/3),j=f.height,e.beginPath(),e.moveTo(f.x,f.y-j/2),e.bezierCurveTo(f.x-i/2,f.y-j/2,f.x-i/2,f.y+j/2,f.x,f.y+j/2),e.bezierCurveTo(f.x+i/2,f.y+j/2,f.x+i/2,f.y-j/2,f.x,f.y-j/2),R(b[d],e,f),f.closed=qb,p(b[d],e,f)));return b},a.fn.drawPolygon=function Yb(a){var b=this,d,e,f,h,i,j,k,l,n,o,r;for(d=0;d<b.length;d+=1){e=g(b[d]);if(e){f=new c(a),h=F(b[d],f,a,Yb);if(f.visible){q(b[d],e,f,f.radius*2),m(b[d],e,f),j=2*Ab/f.sides,k=j/2,i=k+Ab/2,l=f.radius*Eb(k),e.beginPath();for(r=0;r<f.sides;r+=1)n=f.x+f.radius*Eb(i),o=f.y+f.radius*Db(i),e.lineTo(n,o),f.concavity&&(n=f.x+(l+ -l*f.concavity)*Eb(i+k),o=f.y+(l+ -l*f.concavity)*Db(i+k),e.lineTo(n,o)),i+=j;R(b[d],e,f),f.closed=qb,p(b[d],e,f)}}}return b},a.fn.drawSlice=function Zb(b){var d=this,e,f,h,i,j,k,l,n;for(f=0;f<d.length;f+=1)e=a(d[f]),h=g(d[f]),h&&(i=new c(b),j=F(d[f],i,b,Zb),i.visible&&(q(d[f],h,i,i.radius*2),m(d[f],h,i),i.start*=i._toRad,i.end*=i._toRad,i.start-=Ab/2,i.end-=Ab/2,i.start=V(i.start),i.end=V(i.end),i.end<i.start&&(i.end+=2*Ab),k=(i.start+i.end)/2,l=i.radius*i.spread*Eb(k),n=i.radius*i.spread*Db(k),i.x+=l,i.y+=n,h.beginPath(),h.arc(i.x,i.y,i.radius,i.start,i.end,i.ccw),h.lineTo(i.x,i.y),R(d[f],h,i),i.closed=qb,p(d[f],h,i)));return d},a.fn.drawLine=function $b(a){var b=this,d,e,f,h;for(d=0;d<b.length;d+=1)e=g(b[d]),e&&(f=new c(a),h=F(b[d],f,a,$b),f.visible&&(q(b[d],e,f),m(b[d],e,f),e.beginPath(),ab(b[d],e,f,f),R(b[d],e,f),p(b[d],e,f)));return b},a.fn.drawQuadratic=function _b(a){var b=this,d,e,f,h;for(d=0;d<b.length;d+=1)e=g(b[d]),e&&(f=new c(a),h=F(b[d],f,a,_b),f.visible&&(q(b[d],e,f),m(b[d],e,f),e.beginPath(),bb(b[d],e,f,f),R(b[d],e,f),p(b[d],e,f)));return b},a.fn.drawBezier=function ac(a){var b=this,d,e,f,h;for(d=0;d<b.length;d+=1)e=g(b[d]),e&&(f=new c(a),h=F(b[d],f,a,ac),f.visible&&(q(b[d],e,f),m(b[d],e,f),e.beginPath(),cb(b[d],e,f,f),R(b[d],e,f),p(b[d],e,f)));return b},a.fn.drawVector=function bc(a){var b=this,d,e,f,h;for(d=0;d<b.length;d+=1)e=g(b[d]),e&&(f=new c(a),h=F(b[d],f,a,bc),f.visible&&(q(b[d],e,f),m(b[d],e,f),e.beginPath(),fb(b[d],e,f,f),R(b[d],e,f),p(b[d],e,f)));return b},a.fn.drawPath=function cc(a){var b=this,d,e,f,h,i,j;for(d=0;d<b.length;d+=1){e=g(b[d]);if(e){f=new c(a),h=F(b[d],f,a,cc);if(f.visible){q(b[d],e,f),m(b[d],e,f),e.beginPath(),i=1;while(qb){j=f["p"+i];if(j===tb)break;j=new c(j),j.type==="line"?ab(b[d],e,f,j):j.type==="quadratic"?bb(b[d],e,f,j):j.type==="bezier"?cb(b[d],e,f,j):j.type==="vector"?fb(b[d],e,f,j):j.type==="arc"&&Y(b[d],e,f,j),i+=1}R(b[d],e,f),p(b[d],e,f)}}}return b},a.fn.drawText=function dc(b){var d=this,e,f,h,i,j,k,l,n,p,r=500,s,t,u,v,w;for(f=0;f<d.length;f+=1){e=a(d[f]),h=g(d[f]);if(h){i=new c(b),j=F(d[f],i,b,dc);if(i.visible){h.textBaseline=i.baseline,h.textAlign=i.align,gb(d[f],h,i),i.maxWidth!==sb?k=ib(h,i):k=i.text.toString().split("\n"),hb(d[f],h,i,k),j&&(j.width=i.width,j.height=i.height),q(d[f],h,i,i.width,i.height),m(d[f],h,i),v=i.x,i.align==="left"?i.respectAlign?i.x+=i.width/2:v-=i.width/2:i.align==="right"&&(i.respectAlign?i.x-=i.width/2:v+=i.width/2);if(i.radius){p=pb(i.fontSize),i.letterSpacing===sb&&(i.letterSpacing=p/r);for(n=0;n<k.length;n+=1){h.save(),h.translate(i.x,i.y),l=k[n],s=l.length,h.rotate(-(Ab*i.letterSpacing*(s-1))/2);for(u=0;u<s;u+=1)t=l[u],u!==0&&h.rotate(Ab*i.letterSpacing),h.save(),h.translate(0,-i.radius),h.fillText(t,0,0),h.restore();i.radius-=p,i.letterSpacing+=p/(r*2*Ab),h.restore()}}else for(n=0;n<k.length;n+=1)l=k[n],w=i.y+n*i.height/k.length-(k.length-1)*i.height/k.length/2,h.shadowColor=i.shadowColor,h.fillText(l,v,w),i.fillStyle!=="transparent"&&(h.shadowColor="transparent"),i.strokeWidth!==0&&h.strokeText(l,v,w);w=0,i.baseline==="top"?w+=i.height/2:i.baseline==="bottom"&&(w-=i.height/2),i._event&&(h.beginPath(),h.rect(i.x-i.width/2,i.y-i.height/2+w,i.width,i.height),R(d[f],h,i),h.closePath()),o(h,i)}}}return Jb.propCache=i,d},a.fn.measureText=function(a){var b=this,d,e,f;e=b.getLayer(a);if(!e||e&&!e._layer)e=new c(a);return d=g(b[0]),d&&(gb(b[0],d,e),f=ib(d,e),hb(b[0],d,e,f)),e},a.fn.drawImage=function ec(b){function d(a,b,c,d,e){d.width===sb&&d.sWidth===sb&&(d.width=d.sWidth=s.width),d.height===sb&&d.sHeight===sb&&(d.height=d.sHeight=s.height),e&&(e.width=d.width,e.height=d.height),d.sWidth!==sb&&d.sHeight!==sb&&d.sx!==sb&&d.sy!==sb?(d.width===sb&&(d.width=d.sWidth),d.height===sb&&(d.height=d.sHeight),d.cropFromCenter&&(d.sx+=d.sWidth/2,d.sy+=d.sHeight/2),d.sy-d.sHeight/2<0&&(d.sy=d.sHeight/2),d.sy+d.sHeight/2>s.height&&(d.sy=s.height-d.sHeight/2),d.sx-d.sWidth/2<0&&(d.sx=d.sWidth/2),d.sx+d.sWidth/2>s.width&&(d.sx=s.width-d.sWidth/2),q(a,b,d,d.width,d.height),m(a,b,d),b.drawImage(s,d.sx-d.sWidth/2,d.sy-d.sHeight/2,d.sWidth,d.sHeight,d.x-d.width/2,d.y-d.height/2,d.width,d.height)):(q(a,b,d,d.width,d.height),b.drawImage(s,d.x-d.width/2,d.y-d.height/2,d.width,d.height)),b.beginPath(),b.rect(d.x-d.width/2,d.y-d.height/2,d.width,d.height),R(a,b,d),b.closePath(),o(b,d),n(b,c,d)}function e(b,c,e,f,g){return function(){var h=a(b);d(b,c,e,f,g),f.layer?E(h,e,g,"load"):f.load&&f.load.call(h[0],g),f.layer&&(g._masks=e.transforms.masks.slice(0),f._next&&h.drawLayers({clear:rb,resetFire:qb,index:f._next}))}}var f=this,h,i,j,k,l,p,s,t,u,v=Jb.imageCache;for(i=0;i<f.length;i+=1)h=f[i],j=g(f[i]),j&&(k=r(f[i]),l=new c(b),p=F(f[i],l,b,ec),l.visible&&(u=l.source,t=u.getContext,u.src||t?s=u:u&&(v[u]&&v[u].complete?s=v[u]:(s=new kb,u.match(/^data:/i)||(s.crossOrigin=l.crossOrigin),s.src=u,v[u]=s)),s&&(s.complete||t?e(h,j,k,l,p)():(s.onload=e(h,j,k,l,p),s.src=s.src))));return f},a.fn.createPattern=function(b){function d(){k=f.createPattern(i,h.repeat),h.load&&h.load.call(e[0],k)}var e=this,f,h,i,j,k,l;return f=g(e[0]),f?(h=new c(b),l=h.source,yb(l)?(i=a("<canvas />")[0],i.width=h.width,i.height=h.height,j=g(i),l.call(i,j),d()):(j=l.getContext,l.src||j?i=l:(i=new kb,l.match(/^data:/i)||(i.crossOrigin=h.crossOrigin),i.src=l),i.complete||j?d():(i.onload=d(),i.src=i.src))):k=sb,k},a.fn.createGradient=function(a){var b=this,d,e,f,h=[],i,j,k,l,m,n,o;e=new c(a),d=g(b[0]);if(d){e.x1=e.x1||0,e.y1=e.y1||0,e.x2=e.x2||0,e.y2=e.y2||0,e.r1!==sb&&e.r2!==sb?f=d.createRadialGradient(e.x1,e.y1,e.r1,e.x2,e.y2,e.r2):f=d.createLinearGradient(e.x1,e.y1,e.x2,e.y2);for(l=1;e["c"+l]!==tb;l+=1)e["s"+l]!==tb?h.push(e["s"+l]):h.push(sb);i=h.length,h[0]===sb&&(h[0]=0),h[i-1]===sb&&(h[i-1]=1);for(l=0;l<i;l+=1){if(h[l]!==sb){n=1,o=0,j=h[l];for(m=l+1;m<i;m+=1){if(h[m]!==sb){k=h[m];break}n+=1}j>k&&(h[m]=h[l])}else h[l]===sb&&(o+=1,h[l]=j+o*((k-j)/n));f.addColorStop(h[l],e["c"+(l+1)])}}else f=sb;return f},a.fn.setPixels=function fc(a){var b=this,d,e,f,h,i,j,k,l,m,n;for(e=0;e<b.length;e+=1){d=b[e],f=g(d);if(f){h=new c(a),i=F(d,h,a,fc),q(b[e],f,h,h.width,h.height);if(h.width===sb||h.height===sb)h.width=d.width,h.height=d.height,h.x=h.width/2,h.y=h.height/2;if(h.width!==0&&h.height!==0){k=f.getImageData(h.x-h.width/2,h.y-h.height/2,h.width,h.height),l=k.data,n=l.length;if(h.each)for(m=0;m<n;m+=4)j={r:l[m],g:l[m+1],b:l[m+2],a:l[m+3]},h.each.call(d,j,h),l[m]=j.r,l[m+1]=j.g,l[m+2]=j.b,l[m+3]=j.a;f.putImageData(k,h.x-h.width/2,h.y-h.height/2),f.restore()}}}return b},a.fn.getCanvasImage=function(a,b){var c=this,d,e=sb;return c.length!==0&&(d=c[0],d.toDataURL&&(b===tb&&(b=1),e=d.toDataURL("image/"+a,b))),e},a.fn.detectPixelRatio=function(c){var d=this,e,f,h,i,j,k,l,m,n,o;for(h=0;h<d.length;h+=1)f=d[h],e=a(d[h]),i=g(f),o=r(d[h]),o.scaled||(j=b.devicePixelRatio||1,k=i.webkitBackingStorePixelRatio||i.mozBackingStorePixelRatio||i.msBackingStorePixelRatio||i.oBackingStorePixelRatio||i.backingStorePixelRatio||1,l=j/k,l!==1&&(m=f.width,n=f.height,f.width=m*l,f.height=n*l,f.style.width=m+"px",f.style.height=n+"px",i.scale(l,l)),o.pixelRatio=l,o.scaled=qb,c&&c.call(f,l));return d},Nb.clearCache=function(){var a;for(a in Jb)Jb.hasOwnProperty(a)&&(Jb[a]={})},a.support.canvas=a("<canvas />")[0].getContext!==tb,vb(Nb,{defaults:ub,setGlobalProps:m,transformShape:q,detectEvents:R,closePath:p,setCanvasFont:gb,measureText:hb}),a.jCanvas=Nb,a.jCanvasObject=c})